<!DOCTYPE html>
<html id="html" lang="en">
  <head>
    <link rel="manifest" href="./app.webmanifest">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width" />
    <title>Akari Voice Assistant</title>
    <link rel="stylesheet" href="./index.css">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="shortcut icon" href="./favicon.ico">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="theme-color" content="#00ffff">
  </head>


  <div class="option" style="visibility:hidden;">
    <label for="voice">Voice</label>
    <select name="voice" id="voice"></select>
   </div>


    <style>
      .windowstyle{
  border:4px inset whitesmoke;
	background-color: transparent;
	margin:0%;
	width:100vw;
	height:80vh;
	position:fixed;
	top:0;
	left:0;
  z-index:10;
  border-radius: 2.5vh;
      }
      .buttonstyle{
  border:4px inset whitesmoke;
	margin:0%;
	width:100vw;
	height:5vh;
  background-color: black;
  color:white;
  border-radius: 2.5vh;
  z-index:11;
  position:fixed;
  top:calc(80vh + 11px);
  left:0;
      }
    </style>
    <div id="windowspot"></div>
 

        <p class="responsetxt" id="test" >Akari v1.8: Javascript error!</p>
        <br>
        <p class="responsetxt" id="text">⚠️ No speech detected, this message should go away when you talk.</p>
        <br>


    <div id="messages">

</div>
<br>
<br>
<br>
        <button class="button-round" onclick="window.location.href='./settings';">⁝</button>
        <form>
        <input type="text" id="box" class="box" placeholder="What's up?"></input>
      </form>

        <button class="button-long" onclick="textOnly = 'text'; enter(document.getElementById('box').value); ">Enter Command</button>
      



<script>

document.getElementById('box').onkeydown = function(event){
    var e = event || window.event;
    if(e.keyCode == 13){
      textOnly = 'text';
      enter(document.getElementById('box').value); 
      return false;
    }
};


  var VoiceScript = localStorage.getItem('selectedVoiceScript');

  var InputScript = localStorage.getItem('selectedInputScript');

  var AIScript = localStorage.getItem('selectedAIScript');

  var BKGURL = localStorage.getItem('selectedBKGURL');



  

        if (BKGURL == null || BKGURL == "") {
BKGURL = "./Foreshadowing.jpg";
};

var ExCSS1 = document.createElement("style");
  ExCSS1.innerHTML =`
body  {
			background-image: url("`+BKGURL+`");
  		background-color: black;
			background-repeat: no-repeat;
			background-size: cover;
      color:white;
      margin:7px;
			overflow-x: hidden;
			min-height:100vh;
      background-attachment: fixed;
}`;

  var head = document.getElementsByName("head")[0];
  document.head.appendChild(ExCSS1);

  console.log('Background image loaded from persistent settings: '+BKGURL);
  


      if (InputScript == null || InputScript == "") {
InputScript = "./wake.js";
};
 
      if (AIScript == null || AIScript == "") {
AIScript = "./response.js";
};

if (VoiceScript == null || VoiceScript == "") {
VoiceScript = "./speech.js";
};

  var ExJS1 = document.createElement("script");
  ExJS1.src = VoiceScript;

  var head = document.getElementsByName("head")[0];
  document.head.appendChild(ExJS1);

  console.log('VoiceScript ='+VoiceScript);



  var ExJS2 = document.createElement("script");
  ExJS2.src = AIScript;

  head = document.getElementsByName("head")[0];
  document.head.appendChild(ExJS2);

  console.log('AIScript ='+AIScript);


  var ExJS3 = document.createElement("script");
  ExJS3.src = InputScript;

  head = document.getElementsByName("head")[0];
  document.head.appendChild(ExJS3);

  console.log('InputScript ='+InputScript);


//integrated functions
function bubble(text) {
	var Outgoing = '<p class="responsetxt">'+text+'</p><br>' ;
		var messages = document.getElementById('messages');
		messages.insertAdjacentHTML('beforebegin', Outgoing);
    window.scrollTo(0, document.body.scrollHeight);
};

function say(text) {
  if (textOnly == 'text') {
    bubble(text);
  } else {
    speak(text);
  }
};

function bubble_incoming(outcome) {
  var incoming = '<p class="command">'+outcome+'</p><br><br><br>' ;
            var messages = document.getElementById('messages');
            messages.insertAdjacentHTML('beforebegin', incoming);
};

function enter(input) {
  bubble_incoming(input);
  respond(input);
};

function newwindow(weblocation) {
  var windowcode = '<iframe src="'+weblocation+'" class="windowstyle"></iframe><button class="buttonstyle" onclick="closewindow();">Close window.</button>' ;
            var spot = document.getElementById('windowspot');
            spot.innerHTML = windowcode;
};
function closewindow() {
            var spot = document.getElementById('windowspot');
            spot.innerHTML = '';
};
</script>


</html>
